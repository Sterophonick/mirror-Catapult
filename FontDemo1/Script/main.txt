;
; *** FontDemo1 ***
;
; Catapult font demo project, from the v1.32b release.
;
; Requires Catapult v1.32b or later.
;
; Demonstrates some of the new font/character functionality present in version v1.32b.
; Uses tiled (non-rendered fonts). See FontDemo2 for a rendered font demo.
;
; The font tiles were generated using the 'Font Processor' tool from within Catapult.
; The FontMap used is also automatically generated by the font processor.
;

; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
; Main loop
; 

	; update scrolling text
	Call DisplayText

	; pixel slide BG1 for smooth scrolling text
	V_LV0 = G_TICKS
	V_LV0 %= 24
	TileMapSetOffsetX 1 V_LV0
	
	; change text colour on the fly
	V_LV0 Bounce G_TICKS 63
	PaletteSetG [bg] 1 V_LV0
	
	; scroll text up/down screen
	V_LV0 Bounce G_TICKS 63
	V_LV0 -= 16
	TileMapSetOffsetY 1 V_LV0
	
Return


; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
; Display some of the scrolling text on the display.
; Scroll position is determined by the G_TICKS global
; variable.
; 

Function DisplayText 0

	; get string length in characters
	V_LV0 StringGetLength SID_TEST

	; select first character to display
	V_LV1 = G_TICKS
	V_LV1 /= 24
	V_LV1 %= V_LV0

	; calc last character to display
	V_LV2 = V_LV1+11
	V_LV2 Min V_LV2 V_LV0
	
	; display partial string
	StringDisplayPartial 0 8 V_LV1 V_LV2 SID_TEST

Return


; ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
; Setup the display. Two background layers.. one for the
; tiles, one for the background. No sprites.
; 

Function Initialise 0

	; reset display
	DisplaySetAttribute [BlankDisplay] false 
	DisplaySetAttribute [EnableSprite] false
	DisplaySetAttribute [EnableBG0] true
	DisplaySetAttribute [EnableBG1] true	
	DisplaySetAttribute [EnableBG2] false
	DisplaySetAttribute [EnableBG3] false
	DisplaySetAttribute [VideoMode] 0
	DisplaySetAttribute [EnableSpriteWindow] false
	DisplaySetAttribute [EnableWindowA] false
	DisplaySetAttribute [EnableWindowB] false
	DisplaySetAttribute [PageFlip] false

	; reset tilemaps
	TileMapSetpriority 0 0
	TileMapSetpriority 1 1

	TileMapSetColourMode 0 #_COL_16
	TileMapSetColourMode 1 #_COL_16
	
	TileMapSetMapBank 0 31
	TileMapSetMapBank 1 29	; needs two banks, as it is a 64x32 layer

	TileMapSetSize 0 0			; 32x32 tiles
	TileMapSetSize 1 1			; 64x32 tiles - 64 to allow offscreen creation of more tiles for scrolling text

	TileMapSetOffsetX 0 0
	TileMapSetOffsetY 0 0
	TileMapSetOffsetX 1 0
	TileMapSetOffsetY 1 0
	
	TileMapFillRect 0 [all] 0 0 32 32 0
	TileMapFillRect 1 [all] 0 0 64 32 0
	
	; set fontmap
	StringDisplaySetTarget 1 FONTMAP_BIG 0
	StringDisplaySetColour true 0				; use palette bank 0
	
	; load font tiles
	TileDataLoad [bg] RID_TILES_FONT 0 0
	
	; setup font colour
	PaletteSetColour [bg] 1 {20,31,31}
	
Return
